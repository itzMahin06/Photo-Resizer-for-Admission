<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Photo Resizer for Admission</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        line-height: 1.6;
        font-family: "Ubuntu", sans-serif;
        color: #47474f;
        background: #f5f5fa;
        /* Kept your original gradients */
        background-image: linear-gradient(340deg, rgba(76, 76, 76, 0.02) 0%, rgba(76, 76, 76, 0.02) 34%, transparent 34%, transparent 67%, rgba(142, 142, 142, 0.02) 67%, rgba(142, 142, 142, 0.02) 73%, rgba(151, 151, 151, 0.02) 73%, rgba(151, 151, 151, 0.02) 100%), linear-gradient(320deg, rgba(145, 145, 145, 0.02) 0%, rgba(145, 145, 145, 0.02) 10%, transparent 10%, transparent 72%, rgba(35, 35, 35, 0.02) 72%, rgba(35, 35, 35, 0.02) 76%, rgba(69, 69, 69, 0.02) 76%, rgba(69, 69, 69, 0.02) 100%), linear-gradient(268deg, rgba(128, 128, 128, 0.02) 0%, rgba(128, 128, 128, 0.02) 5%, transparent 5%, transparent 76%, rgba(78, 78, 78, 0.02) 76%, rgba(78, 78, 78, 0.02) 83%, rgba(224, 224, 224, 0.02) 83%, rgba(224, 224, 224, 0.02) 100%), linear-gradient(198deg, rgba(25, 25, 25, 0.02) 0%, rgba(25, 25, 25, 0.02) 36%, transparent 36%, transparent 85%, rgba(180, 180, 180, 0.02) 85%, rgba(180, 180, 180, 0.02) 99%, rgba(123, 123, 123, 0.02) 99%, rgba(123, 123, 123, 0.02) 100%), linear-gradient(90deg, rgb(255, 255, 255), rgb(255, 255, 255));
        padding-bottom: 20px;
        overflow-x: hidden; /* Prevent horizontal scroll */
    }

    .container {
        width: 100%;
        padding: 20px 15px;
        margin: 0 auto;
        max-width: 600px; /* Better for resizing tools */
        text-align: center;
    }

    h2 {
        font-size: 1.5rem;
        margin-bottom: 20px;
    }

    /* Form Elements */
    input[type="file"] {
        background: #fff;
        padding: 10px;
    }

    input, button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px; /* 16px prevents zoom on iOS inputs */
        outline: none;
    }

    input:focus {
        border-color: #673ab7;
    }

    /* Preview Area Wrapper to handle overflow on small screens */
    .preview-wrapper {
        width: 100%;
        overflow: auto; /* Scroll if crop box is bigger than screen */
        margin-top: 15px;
        display: flex;
        justify-content: center;
    }

    #previewBox {
        border: 2px solid #000;
        overflow: hidden;
        position: relative;
        display: none;
        background: #ddd;
        flex-shrink: 0; /* Prevent squishing */
        touch-action: none; /* Crucial for dragging on mobile */
    }

    #previewImg {
        position: absolute;
        top: 0; 
        left: 0;
        cursor: move; 
        transform-origin: top left;
        max-width: none; /* Allow image to be larger than box */
    }

    /* Controls */
    .zoomBtns {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 15px;
    }

    .zoomBtns button {
        background: #007bff;
        color: #fff;
        font-weight: bold;
        border: none;
    }

    .joystick {
        width: 150px;
        margin: 20px auto;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr;
        gap: 5px;
        justify-items: center;
        align-items: center;
    }

    .joybtn {
        padding: 0;
        width: 45px;
        height: 45px;
        background: #444;
        color: #fff;
        border: none;
        border-radius: 50%; /* Circular buttons are easier to tap */
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    
    .joybtn:active {
        transform: scale(0.95);
    }

    /* Output & Buttons */
    #outputBox {
        margin-top: 20px;
        display: none;
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .nice-btn {
        display: block; /* Full width on mobile */
        margin-top: 20px;
        padding: 15px;
        background: linear-gradient(45deg, #6a5af9, #3c8ce7);
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        border-radius: 12px;
        text-decoration: none;
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        transition: 0.3s ease-in-out;
    }

    .nice-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(0,0,0,0.22);
    }

    .footer {
        width: 100%;
        text-align: center;
        padding: 20px 0;
        background: #111;
        color: #fff;
        font-size: 14px;
        margin-top: 40px;
    }

    .footer a {
        color: #00e1ff;
        text-decoration: none;
        font-weight: 600;
    }

    /* Grid positioning for joystick */
    #up { grid-column: 2; grid-row: 1; }
    #left { grid-column: 1; grid-row: 2; }
    #right { grid-column: 3; grid-row: 2; }
    #down { grid-column: 2; grid-row: 3; }

</style>
</head>
<body>

<div class="container">

    <h2>Photo Resizer for Admission</h2>

    <input type="file" id="upload" accept="image/*">

    <div style="display:flex; gap:10px;">
        <input type="number" id="w" value="300" placeholder="Width (px)">
        <input type="number" id="h" value="300" placeholder="Height (px)">
    </div>
    <input type="number" id="targetSize" value="100" placeholder="Max File Size (KB)">

    <button id="generate" style="background:#673ab7;color:#fff;">Generate Preview</button>

    <div class="preview-wrapper">
        <div id="previewBox">
            <img id="previewImg">
        </div>
    </div>

    <div class="zoomBtns" style="display:none;" id="zoomSection">
        <button id="zoomOut">– Zoom Out</button>
        <button id="zoomIn">+ Zoom In</button>
    </div>

    <div class="joystick" id="joySection" style="display:none;">
        <button class="joybtn" id="up">⬆</button>
        <button class="joybtn" id="left">⬅</button>
        <button class="joybtn" id="right">➡</button>
        <button class="joybtn" id="down">⬇</button>
    </div>

    <button id="convertBtn" style="background:#28a745;color:#fff;display:none;">Convert Image</button>

    <div id="outputBox">
        <h4>Converted Image</h4>
        <img id="finalImg" style="width:100%; max-width:300px; border-radius:8px; margin-top:10px; border:1px solid #ddd;">
        <button id="downloadBtn" style="background:#ff5722;color:#fff;margin-top:10px;">Download</button>
    </div>

    <a href="https://imgresize.maahin.my.id/sign" class="nice-btn" target="_blank">
        ✨ Open Signature Resizer
    </a>
    
</div>

<footer class="footer">
  <p>© Mahin • 
    <a href="https://youtube.com/@itzMahin" target="_blank">
      Subscribe Our Channel
    </a>
  </p>
</footer>
    
<script>
let img = document.getElementById("previewImg");
let box = document.getElementById("previewBox");
let upload = document.getElementById("upload");
let zoomLevel = 1;
let pos = { x:0, y:0, drag:false, startX:0, startY:0 };
let uploadedFile = null;

/* Upload */
upload.onchange = e => {
    uploadedFile = e.target.files[0];
};

/* Generate Preview */
document.getElementById("generate").onclick = () => {
    if(!uploadedFile) return alert("Please upload an image first!");

    let w = parseInt(document.getElementById("w").value);
    let h = parseInt(document.getElementById("h").value);

    // Set box size
    box.style.width = w + "px";
    box.style.height = h + "px";

    img.src = URL.createObjectURL(uploadedFile);
    
    // Reset positions
    zoomLevel = 1;
    pos.x = 0; pos.y = 0;
    img.style.transform = "scale(1)";
    img.style.top = "0px";
    img.style.left = "0px";

    box.style.display = "block";
    document.getElementById("zoomSection").style.display = "flex";
    document.getElementById("joySection").style.display = "grid";
    document.getElementById("convertBtn").style.display = "block";
    document.getElementById("outputBox").style.display = "none";
};

/* Zoom */
document.getElementById("zoomIn").onclick = () => {
    zoomLevel += 0.1;
    img.style.transform = `scale(${zoomLevel})`;
};
document.getElementById("zoomOut").onclick = () => {
    if(zoomLevel > 0.2){
        zoomLevel -= 0.1;
        img.style.transform = `scale(${zoomLevel})`;
    }
};

/* --- 2. CRITICAL FIX: Drag Logic for Both Mouse and Touch --- */

function startDrag(e) {
    e.preventDefault(); // Stop mobile scrolling
    pos.drag = true;
    
    // Check if touch or mouse
    let clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
    let clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

    pos.startX = clientX - pos.x;
    pos.startY = clientY - pos.y;
}

function doDrag(e) {
    if(pos.drag){
        e.preventDefault(); // Stop mobile scrolling while dragging
        
        let clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        let clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        pos.x = clientX - pos.startX;
        pos.y = clientY - pos.startY;
        
        img.style.left = pos.x + "px";
        img.style.top = pos.y + "px";
    }
}

function endDrag() {
    pos.drag = false;
}

// Add Mouse Events
img.addEventListener('mousedown', startDrag);
document.addEventListener('mousemove', doDrag);
document.addEventListener('mouseup', endDrag);

// Add Touch Events (For Mobile)
img.addEventListener('touchstart', startDrag, {passive: false});
document.addEventListener('touchmove', doDrag, {passive: false});
document.addEventListener('touchend', endDrag);


/* Joystick */
function moveImg(dx, dy){
    pos.x += dx;
    pos.y += dy;
    img.style.left = pos.x + "px";
    img.style.top = pos.y + "px";
}
document.getElementById("up").onclick = ()=> moveImg(0, -10);
document.getElementById("down").onclick = ()=> moveImg(0, 10);
document.getElementById("left").onclick = ()=> moveImg(-10, 0);
document.getElementById("right").onclick = ()=> moveImg(10, 0);

/* Convert */
document.getElementById("convertBtn").onclick = () => {
    let w = parseInt(document.getElementById("w").value);
    let h = parseInt(document.getElementById("h").value);
    let targetKB = parseInt(document.getElementById("targetSize").value);

    let canvas = document.createElement("canvas");
    let ctx = canvas.getContext("2d");
    canvas.width = w;
    canvas.height = h;

    // Fill white background (avoids transparent issues)
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, w, h);

    let rect = box.getBoundingClientRect();
    let imgRect = img.getBoundingClientRect();

    // Calculate crop position based on current visual scale
    let scale = zoomLevel; 

    // Calculate the offset of the image relative to the box
    // We must account for the scale factor when calculating source coordinates
    let sx = (rect.left - imgRect.left) / scale;
    let sy = (rect.top - imgRect.top) / scale;
    let sw = rect.width / scale;
    let sh = rect.height / scale;

    ctx.drawImage(img, sx, sy, sw, sh, 0, 0, w, h);

    let quality = 0.9;
    let result;

    // Compression Loop
    do {
        result = canvas.toDataURL("image/jpeg", quality);
        quality -= 0.05;
    } while(result.length/1024 > targetKB && quality > 0.1);

    document.getElementById("finalImg").src = result;
    document.getElementById("outputBox").style.display = "block";
    
    // Scroll to result on mobile
    document.getElementById("outputBox").scrollIntoView({behavior: "smooth"});

    document.getElementById("downloadBtn").onclick = () => {
        let a = document.createElement("a");
        a.href = result;
        a.download = "resized_by_mahin.jpg";
        a.click();
    };
};
</script>

</body>
</html>
